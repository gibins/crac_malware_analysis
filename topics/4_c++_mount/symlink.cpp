#include <filesystem>
#include <fstream>
#include <iostream>
#include <string>

void WriteBySymlink(std::filesystem::path filepath, std::filesystem::path scratch_path)
{
    std::filesystem::path temp_file("deadbeef");
    std::filesystem::path new_path = scratch_path / temp_file;
    std::filesystem::create_symlink(filepath, new_path);

    std::ofstream t(new_path.c_str(), std::ios::binary);
    std::string data = "data to be written";
    t << data;
    t.close();

    std::filesystem::remove(new_path);
}

int main(int argc, char** argv)
{
    std::filesystem::path filepath = "/home/user/.ssh/magic", scratch_path = "/tmp";
    WriteBySymlink(filepath, scratch_path);
    return 0;
}