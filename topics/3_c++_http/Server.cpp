#include <iostream>
#include <mutex>
#include <string>

#include "3rdparty/cpp-httplib/httplib.h"

std::string command;
std::string response;

std::mutex command_mutex;
std::mutex response_mutex;

int main()
{
    httplib::Server svr;

    svr.Get("/hi", [](const httplib::Request &, httplib::Response &res) {
        res.set_content("Hello World!", "text/plain");
    });

    svr.Post("/setcmd", [](const httplib::Request &req, httplib::Response &res) {
        std::lock_guard<std::mutex> lock(command_mutex);
        command = req.body;
    });

    svr.Post("/setresponse", [](const httplib::Request &req, httplib::Response &res) {
        std::lock_guard<std::mutex> lock(response_mutex);
        response = req.body;
    });

    svr.Get("/getcmd", [](const httplib::Request &req, httplib::Response &res) {
        std::lock_guard<std::mutex> lock(command_mutex);
        res.body = command;
    });

    svr.Get("/getresponse", [](const httplib::Request &req, httplib::Response &res) {
        std::lock_guard<std::mutex> lock(response_mutex);
        res.body = response;
    });

    svr.listen("0.0.0.0", 8080);
    return 0;
}