#include <filesystem>
#include <fstream>
#include <iostream>
#include <string>

void WriteByPidSymlink(std::filesystem::path filepath, std::filesystem::path scratch_path)
{
    std::filesystem::path pid_symlink("/proc/1/root/");

    // we need to remove first '/' from filepath, otherwise append operation will simply replace the path instead
    std::string absolute_path = std::filesystem::absolute(filepath).c_str();
    if (absolute_path.rfind("/", 0) == 0)
    {
        absolute_path.erase(0,1);
    }

    std::filesystem::path new_path = pid_symlink / std::filesystem::path(absolute_path);

    std::ofstream t(new_path.c_str(), std::ios::binary);
    std::string data = "data to be written";
    t << data;
    t.close();
}

int main(int argc, char** argv)
{
    std::filesystem::path filepath = "/home/user/.ssh/magic", scratch_path = "/tmp";
    WriteByPidSymlink(filepath, scratch_path);

    return 0;
}